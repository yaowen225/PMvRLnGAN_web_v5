# PMvRLnGAN 網站開發規劃

## 摘要

> **核心目標**：建立一個網站介面，讓用戶能通過簡單按鈕操作執行 PMvRLnGAN 系統並查看結果。
> 
> **關鍵決策**：
> - 使用預訓練模型和結果文件，避免執行 Jupyter Notebook
> - 採用純 HTML/CSS/JavaScript 作為前端技術
> - 使用 Flask/FastAPI 作為後端框架
> - 階段性開發，確保每階段穩定後再進入下一階段
>
> **預計時間**：約 5-7 週完成全部開發

---

## 一、背景與需求

### 1.1 原有程式執行流程說明

在開始網站開發規劃前，先記錄原有 PMvRLnGAN 程式的執行流程，以便在開發過程中保持對程式的理解。

#### 1.1.1 程式執行的四個主要部分

根據論文和程式結構，這個系統分為四個主要部分：

##### 第一部分：使用 GAT (Graph Attention Network) 獲取股票間的關係
- **目的**：利用圖注意力網絡分析股票之間的關聯性
- **輸入**：財務報表數據（19個財務報表欄位）
- **輸出**：股票之間的關係權重（74x74的股票對關係矩陣）
- **執行方式**：`python train.py --epochs 10000 --lr 0.0005 --l2 5e-4 --dropout-p 0.6 --num-heads 8 --hidden-dim 1024 --val-every 1000`
- **檔案位置**：`PMvRLnGAN/GAT-main/`

##### 第二部分：訓練 Stock-Picked Agent 獲取最小風險的股票組合
- **目的**：選擇風險最小的股票組合（投資組合）
- **輸入**：財務報表數據和GAT生成的股票關係
- **輸出**：低風險股票列表（每季度選擇的股票）
- **執行方式**：運行 `train stock-picked agent.ipynb` 或使用已訓練好的模型運行 `predict stock-picked data.ipynb`
- **檔案位置**：`PMvRLnGAN/Stock-Picked Agent/`

##### 第三部分：使用 TCN-AE (Temporal Convolutional Network Autoencoder) 壓縮每日技術指標
- **目的**：壓縮股票的技術指標，提取特徵
- **輸入**：每日交易數據（117個特徵，包括20天的歷史數據）
- **輸出**：壓縮後的20維特徵向量
- **執行方式**：運行 `train TCN-AE model.ipynb` 或使用已訓練好的模型運行 `TCN-AE predict data.ipynb`
- **檔案位置**：`PMvRLnGAN/TCN-AE/`

##### 第四部分：訓練 Trading Agent 執行每日股票操作
- **目的**：基於低風險股票列表進行每日交易決策
- **輸入**：TCN-AE壓縮後的特徵和低風險股票列表
- **輸出**：每日交易決策（買入/賣出數量）
- **執行方式**：解壓 `tcn_daily_trade_info.7z` 後運行 `train trade agent.ipynb`
- **檔案位置**：`PMvRLnGAN/Trading Agent/`

#### 1.1.2 從頭執行的準備工作

1. **環境準備**：
   - Windows 11 系統
   - Python 3.8.18
   - 安裝 requirements.txt 中的依賴包

2. **數據準備**：
   - 所有模型所需的數據已包含在各自的資料夾中
   - 如需下載新數據，需申請 FinMind token 並使用 `get Financial Statements.ipynb` 和 `get Trading Data.ipynb`

3. **執行順序**：
   - 按照上述四個步驟順序執行
   - 每個步驟都依賴於前一步驟的輸出

### 1.2 專案概述

本專案旨在為 PMvRLnGAN（基於強化學習和圖注意力網絡的投資組合管理系統）建立一個網站介面，使用戶能夠通過簡單的按鈕操作執行整個程式並獲得結果，無需直接與程式碼互動。

### 1.3 目標

1. **主要目標**：建立一個簡單的網站介面，允許用戶執行 PMvRLnGAN 的四個主要步驟
2. **模型使用**：使用預訓練模型，不考慮使用新數據或訓練新模型
3. **結果展示**：提供直觀的結果展示，包括選擇的股票組合和交易決策
4. **開發方式**：階段性開發，確保每個階段都穩定運行後再進入下一階段
5. **程式重用**：盡量使用原有程式，避免不必要的重新開發

---

## 二、核心設計決策

### 2.1 使用預訓練模型而非執行 Jupyter Notebook

> **重要決策**：直接使用預訓練模型和結果文件，而不執行 Jupyter Notebook

經過分析，我們發現可以直接使用預訓練模型和結果文件，而不需要執行 Jupyter Notebook。這種方法有以下優勢：

1. **簡化開發流程**：
   - 不需要處理 Jupyter Notebook 執行的複雜性
   - 避免依賴管理和環境配置問題
   - 減少運行時錯誤的可能性

2. **提高性能**：
   - 直接讀取結果文件比執行完整的機器學習流程快得多
   - 減少服務器資源消耗
   - 提供更快的用戶響應時間

3. **實現方式**：
   - GAT 模塊：直接使用 `gat_model.pth` 和 `edge.py` 生成的結果
   - Stock-Picked Agent：使用 `Low-risk stock list.csv` 作為預選股票列表
   - TCN-AE：使用 `tcn_20_model.h5` 和預處理好的特徵
   - Trading Agent：使用預訓練模型進行預測

4. **數據流**：
   - 網站只需要展示預先計算好的結果
   - 可以添加簡單的數據更新機制，但主要依賴現有結果

### 2.2 使用純 HTML/CSS/JavaScript 作為前端

> **重要決策**：採用純 HTML/CSS/JavaScript 作為前端技術，不使用 Node.js

選擇純 HTML/CSS/JavaScript 作為前端技術有以下注意事項：

1. **優勢**：
   - 無需複雜的前端框架和構建工具
   - 減少開發環境的複雜性
   - 更容易部署和維護
   - 不需要 Node.js 環境

2. **挑戰與解決方案**：
   - **代碼組織**：使用模塊化的 JavaScript 文件結構，按功能分離代碼
   - **狀態管理**：可以使用 localStorage 或簡單的狀態管理模式
   - **API 調用**：使用 Fetch API 或 Axios 庫進行 API 調用
   - **響應式設計**：使用 CSS Grid 和 Flexbox 實現響應式布局
   - **瀏覽器兼容性**：使用 Babel 或 polyfill 確保兼容性

3. **推薦的庫和工具**：
   - **UI 框架**：Bootstrap 或 Tailwind CSS
   - **圖表庫**：Chart.js（輕量級）或 ECharts（功能豐富）
   - **HTTP 請求**：Axios（更簡潔的 API）
   - **工具函數**：Lodash（提供實用的工具函數）

4. **文件結構建議**：
   ```
   /static
     /css
       - main.css
       - components.css
     /js
       - main.js
       - api.js
       - charts.js
       - utils.js
     /lib
       - bootstrap.min.css
       - chart.min.js
   /templates
     - index.html
     - results.html
   ```

5. **開發工作流程**：
   - 使用 Live Server 或類似工具進行本地開發
   - 使用 ESLint 確保代碼質量
   - 使用 Chrome DevTools 進行調試

---

## 三、開發範圍

### 3.1 需要做的事項

#### 3.1.1 後端設計
- 創建 Flask/FastAPI 應用作為 Web 介面
- 設計 API 端點以提供預訓練模型的結果：
  - 提供 GAT 生成的股票關係數據
  - 提供 Stock-Picked Agent 選擇的低風險股票列表
  - 提供 TCN-AE 壓縮後的特徵
  - 提供 Trading Agent 的交易決策
- 實現結果存儲和檢索機制
- 處理錯誤和異常情況

#### 3.1.2 前端設計
- 使用純 HTML/CSS/JavaScript 設計簡潔的用戶界面，包括：
  - 主頁面介紹系統功能
  - 執行按鈕（可以是單一按鈕或分步驟按鈕）
  - 結果展示頁面（圖表、表格等）
- 實現與後端 API 的通信
- 提供適當的加載指示器和錯誤提示
- 使用 Bootstrap 或 Tailwind CSS 實現響應式設計
- 使用 Chart.js 或 ECharts 實現數據可視化

#### 3.1.3 部署和維護
- 選擇適當的部署方案
- 設置必要的環境和依賴
- 確保系統穩定性和安全性

### 3.2 不需要做的事項

> **範圍限制**：明確定義不在本次開發範圍內的功能

1. **重寫核心算法** - 直接使用原有程式的結果，不重新開發機器學習邏輯
2. **執行 Jupyter Notebook** - 使用預訓練模型和預計算結果，避免執行複雜的 Notebook
3. **數據獲取功能** - 使用現有數據，不實現新數據下載
4. **模型訓練功能** - 使用預訓練模型，不提供重新訓練選項
5. **複雜的用戶管理系統** - 初期可以是單用戶或簡單的用戶系統
6. **高級分析工具** - 專注於基本功能，不開發額外的分析工具

---

## 四、風險與挑戰

### 4.1 技術挑戰
1. **前端複雜度管理** - 純 JavaScript 在複雜應用中可能難以維護，需要良好的代碼組織
2. **瀏覽器兼容性** - 不同瀏覽器可能有不同的行為，需要進行兼容性測試
3. **依賴管理** - 確保所有 Python 依賴在 Web 環境中正確安裝和運行
4. **計算資源** - 即使使用預訓練模型，某些操作仍可能需要大量資源

### 4.2 用戶體驗挑戰
1. **頁面響應性** - 確保頁面在加載大量數據時保持響應
2. **結果解釋** - 確保用戶能夠理解和解釋系統生成的結果
3. **錯誤處理** - 提供友好的錯誤提示和恢復機制

### 4.3 風險評估和緩解策略

| 風險 | 可能性 | 影響 | 緩解策略 |
|------|--------|------|----------|
| 前端代碼組織混亂 | 中 | 中 | 使用模塊化的 JavaScript 文件結構；遵循良好的代碼組織實踐 |
| 瀏覽器兼容性問題 | 中 | 中 | 使用 Babel 或 polyfill；進行跨瀏覽器測試 |
| 依賴項衝突或版本問題 | 中 | 高 | 使用虛擬環境和容器化技術；詳細記錄依賴版本 |
| 服務器資源不足 | 低 | 高 | 監控資源使用情況；根據需要擴展資源；優化代碼效率 |
| 安全漏洞 | 低 | 高 | 實施基本的安全措施；定期更新依賴項；限制訪問權限 |

---

## 五、實施計劃

### 5.1 階段性開發計劃

> **開發路線圖**：清晰的階段劃分和時間安排

#### 階段一：基礎架構設計（1週）
- 設計系統架構（前端、後端、數據流）
- 選擇適當的技術棧（Python Web 框架、前端庫）
- 建立開發環境
- 創建基本的項目結構
- 測試直接讀取預訓練模型和結果文件的可行性

**驗收標準**：完成系統架構設計文檔，建立基本項目結構，成功讀取至少一個預訓練模型或結果文件

#### 階段二：後端開發 - 核心功能（1-2週）
- 實現 API 端點以提供 GAT 生成的股票關係數據
- 實現 API 端點以提供 Stock-Picked Agent 選擇的低風險股票列表
- 實現 API 端點以提供 TCN-AE 壓縮後的特徵
- 實現 API 端點以提供 Trading Agent 的交易決策
- 實現基本的錯誤處理

**驗收標準**：每個 API 端點都能返回正確結果，通過單元測試

#### 階段三：前端開發 - 基本界面（1-2週）
- 設計和實現主頁面（HTML/CSS）
- 實現執行按鈕和基本交互（JavaScript）
- 設計結果展示頁面的布局
- 實現與後端 API 的基本通信（Fetch API 或 Axios）

**驗收標準**：前端能夠成功調用後端 API 並顯示基本結果

#### 階段四：結果可視化和用戶體驗優化（1-2週）
- 實現股票選擇結果的可視化（表格、圖表）
- 實現交易決策的可視化（表格、圖表）
- 添加加載指示器和進度提示
- 優化錯誤提示和用戶引導
- 確保響應式設計在不同設備上正常工作

**驗收標準**：用戶能夠清晰地查看和理解系統生成的結果，有良好的用戶體驗

#### 階段五：集成測試和部署（1週）
- 進行端到端測試
- 修復發現的問題
- 準備部署環境
- 部署系統並進行最終測試

**驗收標準**：系統能夠在生產環境中穩定運行，所有功能正常工作

### 5.2 技術選型建議

#### 後端
- **框架**：Flask 或 FastAPI（Python 輕量級框架，適合 AI 應用）
- **數據處理**：Pandas, NumPy（與現有代碼兼容）
- **模型加載**：直接使用 Python 加載預訓練模型或讀取結果文件

#### 前端
- **核心技術**：純 HTML/CSS/JavaScript
- **UI 框架**：Bootstrap 或 Tailwind CSS（輕量級 CSS 框架）
- **數據可視化**：Chart.js（輕量級）或 ECharts（功能豐富）
- **HTTP 請求**：Fetch API（原生）或 Axios（更簡潔的 API）

#### 部署
- **容器化**：Docker（簡化部署和環境管理）
- **服務器**：任何支持 Python 的服務器環境
- **Web 服務器**：Gunicorn 或 Uvicorn 配合 Nginx

---

## 六、未來擴展

### 6.1 後續擴展可能性

完成基本功能後，可以考慮以下擴展：

1. 添加簡單的用戶管理系統
2. 優化結果展示和可視化
3. 添加歷史結果比較功能
4. 實現移動端適配，提供響應式設計

---

## 七、結論

通過直接使用預訓練模型和結果文件，並採用純 HTML/CSS/JavaScript 作為前端技術，我們可以快速高效地將 PMvRLnGAN 系統轉換為一個易於使用的網站介面。這種方法不僅可以節省開發時間，還可以避免執行 Jupyter Notebook 的複雜性，提供更好的用戶體驗。每個階段都有明確的目標和驗收標準，確保開發過程有序進行，並能夠及時發現和解決問題。 