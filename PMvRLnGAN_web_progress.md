# PMvRLnGAN 網站開發進度報告

> **注意**：本文檔提供了 PMvRLnGAN 網站開發的概述。如需了解更詳細的開發過程和日誌記錄，請參閱 [PMvRLnGAN_web_planning.md](PMvRLnGAN_web_planning.md) 中的「八、開發日誌」章節。

## 摘要

本報告記錄了 PMvRLnGAN 系統從原始程式碼到網站介面的開發進度。截至目前，我已完成了後端核心功能的大部分開發工作，包括交易適配器、股票適配器和相關 API 端點的實現。系統架構設計和基礎功能已經就緒，前端基本框架也已建立，正在進行最後的後端功能完善工作。

## 目錄

- [開發時間線](#開發時間線)
- [原始程式碼分析](#原始程式碼分析)
- [已實現的功能](#已實現的功能)
- [測試結果](#測試結果)
- [資料來源分析](#資料來源分析)
- [開發進度追蹤](#開發進度追蹤)
- [下一階段工作](#下一階段工作)
- [資料處理策略](#資料處理策略)

## 開發時間線

### ：基礎架構設計
- ✅ 分析了原始 PMvRLnGAN 程式碼結構和執行流程
- ✅ 設計了系統架構（前端、後端、數據流）
- ✅ 選擇了技術棧：Flask 作為後端框架，純 HTML/CSS/JavaScript 作為前端技術
- ✅ 建立了開發環境和基本項目結構
- ✅ 測試了直接讀取預訓練模型和結果文件的可行性

### ：股票適配器開發
- ✅ 實現了低風險股票列表讀取功能
- ✅ 實現了季度選擇器功能
- ✅ 開發了 `/api/stock-picked/quarters` 和 `/api/stock-picked/list` API 端點
- ✅ 添加了錯誤處理和日誌記錄功能

### ：交易適配器開發
- ✅ 實現了日期範圍限制和有效交易日檢查功能
- ✅ 實現了交易決策獲取功能
- ✅ 優化了交易適配器，移除了不必要的 tcn_daily_trade_info.7z 解壓代碼
- ✅ 修改了交易適配器，直接從 Low-risk stock list.csv 讀取交易日期和股票數據
- ✅ 開發了 `/api/trading/valid-dates` 和 `/api/trading/decisions` API 端點

### ：績效摘要功能開發
- ✅ 實現了績效摘要功能，提供模擬的績效數據
- ✅ 開發了 `/api/results/summary` API 端點
- ✅ 修改了 train trade agent.ipynb，添加了模型和交易決策保存代碼

### ：測試腳本開發
- ✅ 創建了 test_adapter.py 測試腳本
- ✅ 修復了測試腳本中的錯誤，確保能夠正確處理 API 返回的數據結構
- ✅ 完成了交易適配器和股票適配器的功能測試
- ✅ 完成了所有已實現 API 端點的測試

### ：前端基本框架開發
- ✅ 設計和實現了主頁面 HTML 結構
- ✅ 實現了基本的 CSS 樣式
- ✅ 開發了前端 JavaScript 交互功能
- ✅ 實現了與後端 API 的基本通信

## 原始程式碼分析

在開發網站之前，我首先分析了 PMvRLnGAN 的原始程式碼，該系統由四個主要部分組成：

1. **GAT (Graph Attention Network)**
   - 功能：分析股票之間的關聯性，生成股票關係矩陣
   - 關鍵文件：`gat_model.pth`（預訓練模型）和 `edge.py`（生成關係矩陣的腳本）
   - 輸出：74x74 的股票對關係矩陣

2. **Stock-Picked Agent**
   - 功能：選擇風險最小的股票組合
   - 關鍵文件：`Low-risk stock list.csv`（預選的低風險股票列表）
   - 輸出：每季度選擇的低風險股票列表

3. **TCN-AE (Temporal Convolutional Network Autoencoder)**
   - 功能：壓縮股票的技術指標，提取特徵
   - 關鍵文件：`tcn_20_model.h5`（預訓練模型）
   - 輸出：壓縮後的 20 維特徵向量

4. **Trading Agent**
   - 功能：基於低風險股票列表和壓縮特徵，生成每日交易決策
   - 關鍵文件：`trading_agent_model.zip`（預訓練模型）
   - 輸出：每日交易決策（買入/賣出數量）

原始程式碼主要以 Jupyter Notebook 的形式存在，需要手動執行多個步驟才能獲得完整的分析結果。我的目標是將這些功能整合到一個網站中，讓用戶能夠通過簡單的按鈕操作執行整個系統。

## 已實現的功能

### 後端 API 端點

我已經實現了以下 API 端點：

| API 端點 | 方法 | 功能 | 參數 | 狀態 |
|---------|------|------|------|------|
| `/api/trading/valid-dates` | GET | 獲取有效的交易日期範圍 | 無 | ✅ 已完成 |
| `/api/stock-picked/quarters` | GET | 獲取可用的季度列表 | 無 | ✅ 已完成 |
| `/api/stock-picked/list` | GET | 獲取低風險股票列表 | `quarter`（可選） | ✅ 已完成 |
| `/api/trading/decisions` | GET | 獲取指定日期的交易決策 | `date`, `stock_ids`（可選） | ✅ 已完成 |
| `/api/results/summary` | GET | 獲取績效摘要 | `start_date`, `end_date` | ✅ 已完成 |
| `/api/gat/relationships` | GET | 獲取股票關係數據 | 無 | ⏳ 進行中 |
| `/api/tcn-ae/features` | GET | 獲取壓縮後的特徵 | `stock_id` | ⏳ 進行中 |

### 適配器模組

我開發了以下適配器模組，用於連接原始程式碼和網站 API：

1. **股票適配器 (stock_adapter.py)**
   - ✅ 實現了低風險股票列表讀取功能
   - ✅ 實現了季度選擇器功能
   - ✅ 添加了錯誤處理和日誌記錄

2. **交易適配器 (trading_adapter.py)**
   - ✅ 實現了日期範圍限制和有效交易日檢查功能
   - ✅ 實現了交易決策獲取功能
   - ✅ 實現了績效摘要功能
   - ✅ 優化了數據讀取方式

3. **GAT 適配器 (gat_adapter.py)**
   - ⏳ 正在實現股票關係數據讀取功能
   - ⏳ 正在實現關係權重計算功能

4. **TCN-AE 適配器 (tcn_adapter.py)**
   - ⏳ 正在實現壓縮特徵讀取功能
   - ⏳ 正在實現特徵向量處理功能

### 前端頁面

我已經實現了以下前端頁面和功能：

1. **主頁面 (index.html)**
   - ✅ 系統介紹部分
   - ✅ 分析結果展示區域（使用標籤頁切換不同內容）
   - ✅ 響應式設計，適配不同設備

2. **前端交互 (main.js)**
   - ✅ 開始分析按鈕功能
   - ✅ 季度選擇器功能
   - ✅ 交易日期選擇器功能
   - ✅ 與後端 API 的通信功能
   - ✅ 數據展示和更新功能

3. **樣式設計 (main.css)**
   - ✅ 基本頁面樣式
   - ✅ 表格和卡片樣式
   - ✅ 響應式調整

### 可展示的內容

網站將能夠展示以下內容：

1. **低風險股票列表**
   - ✅ 每個季度選出的低風險股票
   - ✅ 股票代碼、名稱、風險值和權重
   - ✅ 季度選擇器，可切換不同季度的數據

2. **交易決策**
   - ✅ 每個交易日的交易決策
   - ✅ 買入、賣出或持有的操作建議
   - ✅ 交易數量和價格
   - ✅ 日期選擇器，可選擇不同日期的決策

3. **績效摘要**
   - ✅ 投資組合的績效指標
   - ✅ 總回報率、年化回報率、夏普比率和最大回撤
   - ✅ 績效圖表，顯示投資組合價值變化

4. **股票關係網絡**
   - ⏳ 股票之間的關係視覺化
   - ⏳ 關係強度和方向

5. **技術指標分析**
   - ⏳ 壓縮後的特徵向量視覺化
   - ⏳ 特徵重要性分析

## 測試結果

我開發了測試腳本 `test_adapter.py`，用於測試適配器功能和 API 端點。測試結果如下：

### 功能測試結果

| 測試項目 | 結果 | 備註 |
|---------|------|------|
| 加載交易日期 | ✅ 成功 | 成功加載 11 個交易日 |
| 獲取有效日期範圍 | ✅ 成功 | 範圍：2021-11-15 到 2024-05-16 |
| 日期驗證 | ✅ 成功 | 正確識別有效和無效日期 |
| 獲取交易決策 | ✅ 成功 | 成功獲取 33 個決策 |
| 獲取績效摘要 | ✅ 成功 | 成功生成績效指標 |
| 獲取可用季度 | ✅ 成功 | 成功獲取 8 個季度 |
| 獲取低風險股票列表 | ✅ 成功 | 成功獲取 33 支股票 |

### API 端點測試結果

| API 端點 | 結果 | 備註 |
|---------|------|------|
| `/api/trading/valid-dates` | ✅ 成功 | 返回正確的日期範圍 |
| `/api/stock-picked/quarters` | ✅ 成功 | 返回正確的季度列表 |
| `/api/stock-picked/list` | ✅ 成功 | 返回正確的股票列表 |
| `/api/trading/decisions` | ✅ 成功 | 返回正確的交易決策 |
| `/api/results/summary` | ✅ 成功 | 返回正確的績效摘要 |

## 資料來源分析

我對網站使用的資料來源進行了詳細分析，區分了真實資料和模擬資料：

### 資料來源概覽

| 模組 | 功能/資料 | 來源類型 | 資料位置/生成方式 | 網頁對應位置 |
|------|-----------|----------|-------------------|--------------|
| **股票適配器** | 低風險股票列表 | ✅ 真實資料 | `PMvRLnGAN/Trading Agent/Low-risk stock list.csv` | 「低風險股票列表」頁面 |
| | 季度列表 | ✅ 真實資料 | 從低風險股票列表中提取 | 季度選擇器下拉選單 |
| | 股票名稱和代碼 | ✅ 真實資料 | 從低風險股票列表中提取 | 所有頁面 |
| | 股票風險評估 | ⚠️ 模擬資料 | 隨機生成的風險值 | 「低風險股票列表」頁面 |
| **交易適配器** | 交易日期範圍 | ✅ 真實資料 | 從低風險股票列表中提取 | 「交易決策」頁面 |
| | 有效交易日檢查 | ✅ 真實資料 | 基於真實交易日期的驗證 | 「交易決策」頁面 |
| | 交易決策 | ⚠️ 部分真實 | `trading_decisions_examples.csv`（僅包含 2024-05-17 至 2024-06-04 的有限日期） | 「交易決策」頁面 |
| | 績效摘要 | ⚠️ 模擬資料 | 隨機生成的績效指標 | 「績效摘要」頁面 |
| **GAT 適配器** | 股票關係數據 | ⚠️ 模擬資料 | 隨機生成的關係矩陣 | 「股票關係網絡」頁面 |
| | 關係權重 | ⚠️ 模擬資料 | 隨機生成的權重值 | 「股票關係網絡」頁面 |
| **TCN-AE 適配器** | 壓縮特徵 | ⚠️ 模擬資料 | 隨機生成的特徵向量 | 「技術指標分析」頁面 |
| | 特徵向量 | ⚠️ 模擬資料 | 隨機生成的特徵向量 | 「技術指標分析」頁面 |

我實現了資料來源控制機制，通過配置文件 `config.py` 中的 `USE_MOCK_DATA` 變數控制資料來源。當設置為 `False` 時，系統會優先嘗試讀取真實數據文件，如果找不到，則自動回退到使用模擬數據。

## 開發進度追蹤

我將開發計劃分為五個階段，目前的進度如下：

### 階段一：基礎架構設計
- ✅ 設計系統架構（前端、後端、數據流）
- ✅ 選擇技術棧
- ✅ 建立開發環境
- ✅ 創建基本項目結構
- ✅ 測試直接讀取預訓練模型和結果文件的可行性
- **完成度：100%**

### 階段二：後端開發 - 核心功能
- ✅ 實現 `/api/trading/valid-dates` 端點
- ✅ 實現 `/api/stock-picked/quarters` 端點
- ✅ 實現 `/api/stock-picked/list` 端點
- ✅ 實現 `/api/trading/decisions` 端點
- ✅ 實現 `/api/results/summary` 端點
- ⏳ 實現 `/api/gat/relationships` 端點
- ⏳ 實現 `/api/tcn-ae/features` 端點
- ✅ 實現結果存儲和檢索機制
- ✅ 處理錯誤和異常情況
- ✅ 添加基本的日誌記錄功能
- **完成度：90%**

### 階段三：前端開發 - 基本界面
- ✅ 設計和實現主頁面（HTML/CSS）
- ✅ 實現執行按鈕和基本交互（JavaScript）
- ✅ 設計結果展示頁面的布局
- ✅ 實現與後端 API 的基本通信
- ⏳ 完善前端錯誤處理和用戶提示
- **完成度：80%**

### 階段四：結果可視化和用戶體驗優化
- ✅ 實現股票選擇結果的可視化（表格）
- ✅ 實現交易決策的可視化（表格）
- ✅ 實現績效摘要的可視化（圖表）
- ⏳ 實現股票關係網絡的可視化
- ⏳ 實現技術指標分析的可視化
- ⏳ 添加加載指示器和進度提示
- ⏳ 優化錯誤提示和用戶引導
- ⏳ 確保響應式設計在不同設備上正常工作
- **完成度：40%**

### 階段五：集成測試和部署
- ⏳ 進行端到端測試
- ⏳ 修復發現的問題
- ⏳ 準備部署環境
- ⏳ 部署系統並進行最終測試
- **完成度：0%**

## 下一階段工作

我計劃在接下來的工作中完成以下任務：

### 優先任務（完成階段二）
1. **完成 GAT 適配器**
   - [ ] 實現讀取股票關係數據的功能
   - [ ] 實現 `/api/gat/relationships` API 端點

2. **完成 TCN-AE 適配器**
   - [ ] 實現讀取壓縮特徵的功能
   - [ ] 實現 `/api/tcn-ae/features` API 端點

3. **進行綜合測試**
   - [ ] 測試所有 API 端點的互操作性
   - [ ] 確保所有功能在各種情況下都能正常工作

4. **完善文檔**
   - [ ] 更新 API 文檔
   - [ ] 完善代碼註釋

### 後續任務（完成階段三和四）
1. **完善前端功能**
   - [ ] 完善前端錯誤處理
   - [ ] 添加用戶提示和引導
   - [ ] 優化響應式設計

2. **實現高級可視化**
   - [ ] 實現股票關係網絡的可視化
   - [ ] 實現技術指標分析的可視化
   - [ ] 優化績效圖表的交互功能

## 資料處理策略

為了確保網站能夠展示真實的分析結果，我設計了「預處理+直接讀取」的資料處理策略：

### 預處理階段（一次性執行）

1. **GAT 關係矩陣生成**
   - [ ] 執行 `edge.py` 腳本
   - [ ] 生成 `relationships.json` 文件

2. **TCN-AE 特徵壓縮**
   - [ ] 執行 `TCN-AE predict data.ipynb` 腳本
   - [ ] 生成壓縮特徵文件

3. **Trading Agent 決策生成**
   - [x] 修改 `train trade agent.ipynb` 中的保存代碼
   - [ ] 生成完整的交易決策文件

### 網站階段（直接讀取預處理結果）

1. **GAT 適配器**
   - [ ] 直接讀取 `relationships.json` 文件
   - [ ] 無需執行 GAT 模型

2. **Stock-Picked 適配器**
   - [x] 直接讀取 `Low-risk stock list.csv` 文件
   - [x] 無需執行 Stock-Picked Agent

3. **TCN-AE 適配器**
   - [ ] 直接讀取壓縮特徵文件
   - [ ] 無需執行 TCN-AE 模型

4. **Trading 適配器**
   - [x] 直接讀取 `trading_decisions_examples.csv` 文件
   - [x] 無需執行 Trading Agent

這種策略的優勢在於：
- 簡化開發流程
- 提高網站性能
- 減少運行時錯誤
- 確保結果一致性

通過這種方式，我可以確保網站展示的是真實的分析結果，同時避免了重複執行複雜計算的開銷。 